# ä¸šåŠ¡æµç¨‹ä¼˜åŒ– API ä½¿ç”¨æŒ‡å—

> ç‰ˆæœ¬: 1.0 | æ›´æ–°: 2026-01-28
> é¢å‘å‰ç«¯å¼€å‘äººå‘˜çš„APIé›†æˆæ–‡æ¡£

---

## ğŸ“‹ ç›®å½•

1. [æ¨¡å—1ï¼šæŠ¥ä»·å•ç›´æ¥ç”Ÿæˆå§”æ‰˜å•](#æ¨¡å—1æŠ¥ä»·å•ç›´æ¥ç”Ÿæˆå§”æ‰˜å•)
2. [æ¨¡å—2ï¼šå®¡æ‰¹é©³å›åŠŸèƒ½](#æ¨¡å—2å®¡æ‰¹é©³å›åŠŸèƒ½)
3. [æ¨¡å—3ï¼šPDFç”Ÿæˆæ§åˆ¶](#æ¨¡å—3pdfç”Ÿæˆæ§åˆ¶)
4. [æ¨¡å—4ï¼šä¸šåŠ¡å•ä½å®¡æ‰¹](#æ¨¡å—4ä¸šåŠ¡å•ä½å®¡æ‰¹)
5. [é€šç”¨è¯´æ˜](#é€šç”¨è¯´æ˜)

---

## æ¨¡å—1ï¼šæŠ¥ä»·å•ç›´æ¥ç”Ÿæˆå§”æ‰˜å•

### åŠŸèƒ½è¯´æ˜

æ”¯æŒä»æŠ¥ä»·å•ç›´æ¥ç”Ÿæˆå§”æ‰˜å•ï¼Œè·³è¿‡åˆåŒç¯èŠ‚ã€‚

### APIç«¯ç‚¹

```
POST /api/quotation/[id]/create-entrustment
```

### è¯·æ±‚å‚æ•°

| å‚æ•° | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| id | string | æ˜¯ | æŠ¥ä»·å•IDï¼ˆè·¯å¾„å‚æ•°ï¼‰ |
| contactPerson | string | å¦ | è”ç³»äººï¼ˆä¼˜å…ˆä½¿ç”¨æ­¤å€¼ï¼Œå¦åˆ™ä»æŠ¥ä»·å•å¤åˆ¶ï¼‰ |
| sampleDate | string | å¦ | é€æ ·æ—¶é—´ï¼ˆISO 8601æ ¼å¼ï¼‰ |
| follower | string | å¦ | è·Ÿè¿›äººï¼ˆä¼˜å…ˆä½¿ç”¨æ­¤å€¼ï¼Œå¦åˆ™ä»æŠ¥ä»·å•å¤åˆ¶ï¼‰ |
| remark | string | å¦ | å¤‡æ³¨ä¿¡æ¯ |

### è¯·æ±‚ç¤ºä¾‹

**ä½¿ç”¨ fetchï¼š**
```javascript
const response = await fetch('/api/quotation/clxxxxxxx/create-entrustment', {
  method: 'POST',
  headers: {
    'Content-Type': 'application/json',
  },
  body: JSON.stringify({
    contactPerson: 'å¼ ä¸‰',
    sampleDate: '2026-01-28T10:00:00Z',
    follower: 'æå››',
    remark: 'æ€¥ä»¶ï¼Œè¯·å°½å¿«å¤„ç†'
  })
})

const result = await response.json()
console.log(result)
```

**ä½¿ç”¨ axiosï¼š**
```javascript
import axios from 'axios'

const { data } = await axios.post('/api/quotation/clxxxxxxx/create-entrustment', {
  contactPerson: 'å¼ ä¸‰',
  sampleDate: new Date('2026-01-28 10:00:00').toISOString(),
  follower: 'æå››',
  remark: 'æ€¥ä»¶'
})

console.log(data)
```

### å“åº”ç¤ºä¾‹

**æˆåŠŸå“åº”ï¼ˆ200 OKï¼‰ï¼š**
```json
{
  "success": true,
  "data": {
    "success": true,
    "entrustmentId": "cl1234567890abcdef",
    "entrustmentNo": "WT-20260128-001",
    "quotationNo": "BJ20260128001",
    "contractNo": "HT-20260128-001",
    "message": "å§”æ‰˜å•åˆ›å»ºæˆåŠŸï¼Œå·²å¤åˆ¶ 5 ä¸ªæ£€æµ‹é¡¹ç›®"
  },
  "message": "å§”æ‰˜å•åˆ›å»ºæˆåŠŸï¼Œå·²å¤åˆ¶ 5 ä¸ªæ£€æµ‹é¡¹ç›®"
}
```

**é”™è¯¯å“åº”ï¼ˆ400 Bad Requestï¼‰ï¼š**
```json
{
  "success": false,
  "error": "æŠ¥ä»·å•æœªå®¡æ‰¹é€šè¿‡ï¼Œæ— æ³•ç”Ÿæˆå§”æ‰˜å•"
}
```

**é”™è¯¯å“åº”ï¼ˆ404 Not Foundï¼‰ï¼š**
```json
{
  "success": false,
  "error": "æŠ¥ä»·å•ä¸å­˜åœ¨"
}
```

### å‰ç«¯é›†æˆç¤ºä¾‹

**Reactç»„ä»¶ç¤ºä¾‹ï¼š**
```tsx
import { useState } from 'react'
import { message } from 'antd'

interface CreateEntrustmentButtonProps {
  quotationId: string
  onSuccess?: (entrustmentId: string) => void
}

export function CreateEntrustmentButton({
  quotationId,
  onSuccess
}: CreateEntrustmentButtonProps) {
  const [loading, setLoading] = useState(false)

  const handleCreate = async () => {
    setLoading(true)
    try {
      const response = await fetch(
        `/api/quotation/${quotationId}/create-entrustment`,
        {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            contactPerson: 'é»˜è®¤è”ç³»äºº',
            follower: 'é»˜è®¤è·Ÿè¿›äºº'
          })
        }
      )

      const result = await response.json()

      if (result.success) {
        message.success(result.data.message)
        onSuccess?.(result.data.entrustmentId)
      } else {
        message.error(result.error)
      }
    } catch (error) {
      message.error('åˆ›å»ºå§”æ‰˜å•å¤±è´¥')
    } finally {
      setLoading(false)
    }
  }

  return (
    <button
      onClick={handleCreate}
      disabled={loading}
      className="btn-primary"
    >
      {loading ? 'åˆ›å»ºä¸­...' : 'ç”Ÿæˆå§”æ‰˜å•'}
    </button>
  )
}
```

**Tableæ“ä½œåˆ—é›†æˆï¼š**
```tsx
import { Button } from 'antd'
import { FileTextOutlined } from '@ant-design/icons'

const columns = [
  {
    title: 'æŠ¥ä»·å•å·',
    dataIndex: 'quotationNo',
    key: 'quotationNo'
  },
  {
    title: 'çŠ¶æ€',
    dataIndex: 'status',
    key: 'status',
    render: (status: string) => {
      const statusMap = {
        draft: 'è‰ç¨¿',
        pending: 'å®¡æ‰¹ä¸­',
        approved: 'å·²é€šè¿‡',
        rejected: 'å·²é©³å›'
      }
      return statusMap[status] || status
    }
  },
  {
    title: 'æ“ä½œ',
    key: 'action',
    render: (_: any, record: any) => (
      <Button
        type="primary"
        icon={<FileTextOutlined />}
        disabled={record.status !== 'approved'}
        onClick={() => handleCreateEntrustment(record.id)}
      >
        ç”Ÿæˆå§”æ‰˜å•
      </Button>
    )
  }
]
```

---

## æ¨¡å—2ï¼šå®¡æ‰¹é©³å›åŠŸèƒ½

### åŠŸèƒ½è¯´æ˜

é©³å›pendingçŠ¶æ€çš„å•æ®å›å‘èµ·äººï¼Œè¦æ±‚ä¿®æ”¹åé‡æ–°æäº¤ã€‚

### APIç«¯ç‚¹

```
POST /api/quotation/[id]/reject
POST /api/contract/[id]/reject
POST /api/entrustment/[id]/reject
POST /api/client/[id]/reject
```

### è¯·æ±‚å‚æ•°

| å‚æ•° | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| id | string | æ˜¯ | å•æ®IDï¼ˆè·¯å¾„å‚æ•°ï¼‰ |
| rejectReason | string | æ˜¯ | é©³å›åŸå› ï¼ˆä¸èƒ½ä¸ºç©ºæˆ–åªæœ‰ç©ºæ ¼ï¼‰ |

### è¯·æ±‚ç¤ºä¾‹

```javascript
const response = await fetch('/api/quotation/clxxxxxxx/reject', {
  method: 'POST',
  headers: {
    'Content-Type': 'application/json',
  },
  body: JSON.stringify({
    rejectReason: 'å•ä»·è¿‡ä½ï¼Œè¯·é‡æ–°æ ¸ç®—æˆæœ¬'
  })
})

const result = await response.json()
```

### å“åº”ç¤ºä¾‹

**æˆåŠŸå“åº”ï¼ˆ200 OKï¼‰ï¼š**
```json
{
  "success": true,
  "data": {
    "success": true,
    "rejectedCount": 1,
    "lastRejectReason": "å•ä»·è¿‡ä½ï¼Œè¯·é‡æ–°æ ¸ç®—æˆæœ¬",
    "lastRejectBy": "user-123",
    "lastRejectAt": "2026-01-28T10:00:00.000Z"
  },
  "message": "é©³å›æˆåŠŸ"
}
```

**é”™è¯¯å“åº”ï¼ˆ400 Bad Requestï¼‰ï¼š**
```json
{
  "success": false,
  "error": "é©³å›åŸå› ä¸èƒ½ä¸ºç©º"
}
```

```json
{
  "success": false,
  "error": "è‰ç¨¿çŠ¶æ€çš„å•æ®æ— æ³•é©³å›"
}
```

### å‰ç«¯é›†æˆç¤ºä¾‹

**é©³å›å¯¹è¯æ¡†ç»„ä»¶ï¼š**
```tsx
import { Modal, Input, message } from 'antd'
import { useState } from 'react'

interface RejectModalProps {
  visible: boolean
  documentId: string
  documentType: 'quotation' | 'contract' | 'entrustment' | 'client'
  onCancel: () => void
  onSuccess?: () => void
}

export function RejectModal({
  visible,
  documentId,
  documentType,
  onCancel,
  onSuccess
}: RejectModalProps) {
  const [rejectReason, setRejectReason] = useState('')
  const [loading, setLoading] = useState(false)

  const handleReject = async () => {
    if (!rejectReason.trim()) {
      message.warning('è¯·è¾“å…¥é©³å›åŸå› ')
      return
    }

    setLoading(true)
    try {
      const response = await fetch(
        `/api/${documentType}/${documentId}/reject`,
        {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ rejectReason })
        }
      )

      const result = await response.json()

      if (result.success) {
        message.success('é©³å›æˆåŠŸ')
        setRejectReason('')
        onSuccess?.()
        onCancel()
      } else {
        message.error(result.error)
      }
    } catch (error) {
      message.error('é©³å›å¤±è´¥')
    } finally {
      setLoading(false)
    }
  }

  return (
    <Modal
      title="é©³å›å•æ®"
      open={visible}
      onOk={handleReject}
      onCancel={onCancel}
      confirmLoading={loading}
      okText="ç¡®è®¤é©³å›"
      cancelText="å–æ¶ˆ"
    >
      <Input.TextArea
        rows={4}
        placeholder="è¯·è¾“å…¥é©³å›åŸå› ï¼ˆå¿…å¡«ï¼‰"
        value={rejectReason}
        onChange={(e) => setRejectReason(e.target.value)}
        maxLength={500}
        showCount
      />
    </Modal>
  )
}
```

**æ“ä½œåˆ—æŒ‰é’®ï¼š**
```tsx
const columns = [
  // ... å…¶ä»–åˆ—
  {
    title: 'æ“ä½œ',
    key: 'action',
    render: (_: any, record: any) => (
      <Space>
        {record.status === 'pending' && (
          <Button
            danger
            onClick={() => {
              setSelectedRecord(record)
              setRejectModalVisible(true)
            }}
          >
            é©³å›
          </Button>
        )}
      </Space>
    )
  }
]
```

---

## æ¨¡å—3ï¼šPDFç”Ÿæˆæ§åˆ¶

### åŠŸèƒ½è¯´æ˜

åªæœ‰approvedçŠ¶æ€çš„æŠ¥ä»·å•æ‰èƒ½ç”ŸæˆPDFï¼Œå…¶ä»–çŠ¶æ€è¿”å›403é”™è¯¯ã€‚

### APIç«¯ç‚¹

```
GET /api/quotation/[id]/pdf
```

### è¯·æ±‚ç¤ºä¾‹

```javascript
// ç›´æ¥æ‰“å¼€æ–°çª—å£æ‰“å°
const handlePrintPDF = (quotationId: string) => {
  window.open(`/api/quotation/${quotationId}/pdf`, '_blank')
}

// æˆ–è€…ä½¿ç”¨fetchä¸‹è½½
const handleDownloadPDF = async (quotationId: string) => {
  try {
    const response = await fetch(`/api/quotation/${quotationId}/pdf`)

    if (response.ok) {
      // æˆåŠŸï¼Œæ˜¾ç¤ºPDF
      const html = await response.text()
      const newWindow = window.open('', '_blank')
      newWindow?.document.write(html)
      newWindow?.document.close()
    } else {
      // å¤±è´¥ï¼Œæ˜¾ç¤ºé”™è¯¯
      const result = await response.json()
      message.error(result.error || 'æ— æ³•ç”ŸæˆPDF')
    }
  } catch (error) {
    message.error('ç”ŸæˆPDFå¤±è´¥')
  }
}
```

### å“åº”ç¤ºä¾‹

**æˆåŠŸå“åº”ï¼ˆ200 OKï¼‰ï¼š**
```
Content-Type: text/html; charset=utf-8

<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <title>æŠ¥ä»·å• - BJ20260128001</title>
  ...
</head>
<body>
  ...
  <button class="print-btn" onclick="window.print()">æ‰“å° / å¯¼å‡ºPDF</button>
  ...
</body>
</html>
```

**é”™è¯¯å“åº”ï¼ˆ403 Forbiddenï¼‰ï¼š**
```json
{
  "success": false,
  "error": "æŠ¥ä»·å•æ­£åœ¨å®¡æ‰¹ä¸­ï¼Œè¯·è€å¿ƒç­‰å¾…å®¡æ‰¹å®Œæˆåå†ç”ŸæˆPDF",
  "currentStatus": "pending"
}
```

### å‰ç«¯é›†æˆç¤ºä¾‹

**PDFæŒ‰é’®ç»„ä»¶ï¼š**
```tsx
import { Button, message } from 'antd'
import { PrinterOutlined } from '@ant-design/icons'

interface PDFButtonProps {
  quotationId: string
  status: string
}

export function PDFButton({ quotationId, status }: PDFButtonProps) {
  const handlePrint = () => {
    if (status !== 'approved') {
      message.warning('åªæœ‰å®¡æ‰¹é€šè¿‡çš„æŠ¥ä»·å•æ‰èƒ½ç”ŸæˆPDF')
      return
    }
    window.open(`/api/quotation/${quotationId}/pdf`, '_blank')
  }

  return (
    <Button
      type="primary"
      icon={<PrinterOutlined />}
      disabled={status !== 'approved'}
      onClick={handlePrint}
    >
      æ‰“å°PDF
    </Button>
  )
}
```

**çŠ¶æ€æç¤ºä¼˜åŒ–ï¼š**
```tsx
const getStatusTooltip = (status: string) => {
  const tooltips = {
    draft: 'æŠ¥ä»·å•å°šæœªæäº¤å®¡æ‰¹ï¼Œè¯·å…ˆæäº¤å®¡æ‰¹åå†ç”ŸæˆPDF',
    pending: 'æŠ¥ä»·å•æ­£åœ¨å®¡æ‰¹ä¸­ï¼Œè¯·è€å¿ƒç­‰å¾…å®¡æ‰¹å®Œæˆåå†ç”ŸæˆPDF',
    rejected: 'æŠ¥ä»·å•å·²è¢«é©³å›ï¼Œè¯·ä¿®æ”¹å†…å®¹åé‡æ–°æäº¤å®¡æ‰¹',
    archived: 'æŠ¥ä»·å•å·²å½’æ¡£ï¼Œæ— æ³•ç”ŸæˆPDF',
    approved: 'ç‚¹å‡»ç”ŸæˆPDF'
  }
  return tooltips[status] || 'æ— æ³•ç”ŸæˆPDF'
}

<Button
  tooltip={getStatusTooltip(status)}
  disabled={status !== 'approved'}
  onClick={() => window.open(`/api/quotation/${quotationId}/pdf`)}
>
  æ‰“å°PDF
</Button>
```

---

## æ¨¡å—4ï¼šä¸šåŠ¡å•ä½å®¡æ‰¹

### åŠŸèƒ½è¯´æ˜

ä¸šåŠ¡å•ä½çš„ç®€å•1æ­¥å®¡æ‰¹æµç¨‹ã€‚

### APIç«¯ç‚¹

**æäº¤å®¡æ‰¹ï¼š**
```
POST /api/client/[id]/submit
```

**å®¡æ‰¹é€šè¿‡ï¼š**
```
POST /api/client/[id]/approve
```

### è¯·æ±‚ç¤ºä¾‹

**æäº¤å®¡æ‰¹ï¼š**
```javascript
const response = await fetch('/api/client/clxxxxxxx/submit', {
  method: 'POST',
  headers: {
    'Content-Type': 'application/json',
  },
  body: JSON.stringify({
    comment: 'è¯·å®¡æ‰¹'
  })
})

const result = await response.json()
```

**å®¡æ‰¹é€šè¿‡ï¼š**
```javascript
const response = await fetch('/api/client/clxxxxxxx/approve', {
  method: 'POST',
  headers: {
    'Content-Type': 'application/json',
  },
  body: JSON.stringify({
    comment: 'å®¡æ‰¹é€šè¿‡'
  })
})

const result = await response.json()
```

### å“åº”ç¤ºä¾‹

**æäº¤å®¡æ‰¹æˆåŠŸï¼ˆ200 OKï¼‰ï¼š**
```json
{
  "success": true,
  "data": {
    "success": true,
    "status": "pending",
    "message": "æäº¤å®¡æ‰¹æˆåŠŸ"
  },
  "message": "æäº¤å®¡æ‰¹æˆåŠŸ"
}
```

**å®¡æ‰¹é€šè¿‡æˆåŠŸï¼ˆ200 OKï¼‰ï¼š**
```json
{
  "success": true,
  "data": {
    "success": true,
    "status": "approved",
    "message": "å®¡æ‰¹é€šè¿‡"
  },
  "message": "å®¡æ‰¹é€šè¿‡"
}
```

**é”™è¯¯å“åº”ï¼ˆ400 Bad Requestï¼‰ï¼š**
```json
{
  "success": false,
  "error": "å½“å‰çŠ¶æ€æ— æ³•æäº¤å®¡æ‰¹"
}
```

### å‰ç«¯é›†æˆç¤ºä¾‹

**å®¡æ‰¹æ“ä½œæŒ‰é’®ï¼š**
```tsx
import { Button, Space, message } from 'antd'
import { CheckOutlined, SendOutlined } from '@ant-design/icons'

interface ApprovalButtonsProps {
  clientId: string
  status: string
  onSuccess?: () => void
}

export function ApprovalButtons({
  clientId,
  status,
  onSuccess
}: ApprovalButtonsProps) {
  const handleSubmit = async () => {
    try {
      const response = await fetch(`/api/client/${clientId}/submit`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ comment: 'æäº¤å®¡æ‰¹' })
      })

      const result = await response.json()

      if (result.success) {
        message.success('æäº¤æˆåŠŸ')
        onSuccess?.()
      } else {
        message.error(result.error)
      }
    } catch (error) {
      message.error('æäº¤å¤±è´¥')
    }
  }

  const handleApprove = async () => {
    try {
      const response = await fetch(`/api/client/${clientId}/approve`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ comment: 'å®¡æ‰¹é€šè¿‡' })
      })

      const result = await response.json()

      if (result.success) {
        message.success('å®¡æ‰¹é€šè¿‡')
        onSuccess?.()
      } else {
        message.error(result.error)
      }
    } catch (error) {
      message.error('å®¡æ‰¹å¤±è´¥')
    }
  }

  return (
    <Space>
      {(status === 'draft' || status === 'rejected') && (
        <Button
          type="primary"
          icon={<SendOutlined />}
          onClick={handleSubmit}
        >
          æäº¤å®¡æ‰¹
        </Button>
      )}
      {status === 'pending' && (
        <Button
          type="primary"
          icon={<CheckOutlined />}
          onClick={handleApprove}
        >
          å®¡æ‰¹é€šè¿‡
        </Button>
      )}
    </Space>
  )
}
```

---

## é€šç”¨è¯´æ˜

### é”™è¯¯å¤„ç†

æ‰€æœ‰APIéµå¾ªç»Ÿä¸€çš„é”™è¯¯å“åº”æ ¼å¼ï¼š

```typescript
interface ErrorResponse {
  success: false
  error: string  // ç”¨æˆ·å‹å¥½çš„é”™è¯¯æ¶ˆæ¯
}
```

**é”™è¯¯å¤„ç†ç¤ºä¾‹ï¼š**
```typescript
const response = await fetch('/api/quotation/id/action', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify(data)
})

const result = await response.json()

if (!response.ok || !result.success) {
  // æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯
  message.error(result.error || 'æ“ä½œå¤±è´¥')
  return
}

// å¤„ç†æˆåŠŸç»“æœ
console.log(result.data)
```

### HTTPçŠ¶æ€ç 

| çŠ¶æ€ç  | è¯´æ˜ |
|--------|------|
| 200 | æ“ä½œæˆåŠŸ |
| 400 | è¯·æ±‚å‚æ•°é”™è¯¯æˆ–ä¸šåŠ¡è§„åˆ™é™åˆ¶ |
| 401 | æœªæˆæƒï¼ˆæœªç™»å½•ï¼‰ |
| 403 | æ— æƒé™ï¼ˆçŠ¶æ€ä¸å…è®¸æ­¤æ“ä½œï¼‰ |
| 404 | èµ„æºä¸å­˜åœ¨ |
| 500 | æœåŠ¡å™¨å†…éƒ¨é”™è¯¯ |

### çŠ¶æ€æšä¸¾

**æŠ¥ä»·å•çŠ¶æ€ï¼š**
```typescript
type QuotationStatus = 'draft' | 'pending' | 'approved' | 'rejected' | 'archived'
```

**ä¸šåŠ¡å•ä½çŠ¶æ€ï¼š**
```typescript
type ClientStatus = 'draft' | 'pending' | 'approved' | 'rejected'
```

### TypeScriptç±»å‹å®šä¹‰

**æ¨¡å—1å“åº”ç±»å‹ï¼š**
```typescript
interface CreateEntrustmentResponse {
  success: boolean
  data: {
    success: boolean
    entrustmentId: string
    entrustmentNo: string
    quotationNo: string
    contractNo?: string
    message: string
  }
  message?: string
}
```

**æ¨¡å—2å“åº”ç±»å‹ï¼š**
```typescript
interface RejectResponse {
  success: boolean
  data: {
    success: boolean
    rejectedCount: number
    lastRejectReason: string
    lastRejectBy: string
    lastRejectAt: string
  }
  message: string
}
```

**æ¨¡å—4å“åº”ç±»å‹ï¼š**
```typescript
interface ApprovalResponse {
  success: boolean
  data: {
    success: boolean
    status: string
    message: string
  }
  message: string
}
```

---

## æœ€ä½³å®è·µ

### 1. æŒ‰é’®çŠ¶æ€ç®¡ç†

æ ¹æ®å•æ®çŠ¶æ€åŠ¨æ€æ§åˆ¶æŒ‰é’®å¯ç”¨æ€§ï¼š

```tsx
const getButtonState = (status: string) => {
  return {
    disabled: status !== 'approved',
    tooltip: status !== 'approved'
      ? 'åªæœ‰å®¡æ‰¹é€šè¿‡åæ‰èƒ½æ“ä½œ'
      : 'ç‚¹å‡»æ‰§è¡Œæ“ä½œ'
  }
}
```

### 2. æ“ä½œç¡®è®¤

å¯¹äºé‡è¦æ“ä½œï¼ˆå¦‚é©³å›ã€å®¡æ‰¹ï¼‰ï¼Œæ·»åŠ äºŒæ¬¡ç¡®è®¤ï¼š

```tsx
const handleReject = () => {
  Modal.confirm({
    title: 'ç¡®è®¤é©³å›',
    content: 'é©³å›åå•æ®å°†é€€å›å‘èµ·äººä¿®æ”¹ï¼Œç¡®å®šç»§ç»­ï¼Ÿ',
    onOk: async () => {
      // æ‰§è¡Œé©³å›æ“ä½œ
    }
  })
}
```

### 3. æ“ä½œåé¦ˆ

æ‰€æœ‰æ“ä½œå®Œæˆåç»™äºˆæ˜ç¡®åé¦ˆï¼š

```tsx
const handleAction = async () => {
  setLoading(true)
  try {
    const result = await apiCall()
    if (result.success) {
      message.success('æ“ä½œæˆåŠŸ')
      // åˆ·æ–°åˆ—è¡¨æˆ–è·³è½¬
    } else {
      message.error(result.error)
    }
  } catch (error) {
    message.error('æ“ä½œå¤±è´¥ï¼Œè¯·é‡è¯•')
  } finally {
    setLoading(false)
  }
}
```

### 4. æ•°æ®åˆ·æ–°

æ“ä½œæˆåŠŸååˆ·æ–°ç›¸å…³æ•°æ®ï¼š

```tsx
const { refresh } = useTable()

const handleSubmit = async () => {
  const result = await submitForApproval(id)
  if (result.success) {
    refresh()  // åˆ·æ–°è¡¨æ ¼æ•°æ®
  }
}
```

---

## å®Œæ•´ç¤ºä¾‹

**æŠ¥ä»·å•åˆ—è¡¨é¡µé¢ï¼ˆé›†æˆæ‰€æœ‰åŠŸèƒ½ï¼‰ï¼š**
```tsx
import { Table, Button, Space, message, Modal, Input } from 'antd'
import { useState } from 'react'

export function QuotationList() {
  const [selectedQuotation, setSelectedQuotation] = useState<any>(null)
  const [rejectModalVisible, setRejectModalVisible] = useState(false)

  const columns = [
    {
      title: 'æŠ¥ä»·å•å·',
      dataIndex: 'quotationNo',
      key: 'quotationNo'
    },
    {
      title: 'çŠ¶æ€',
      dataIndex: 'status',
      key: 'status',
      render: (status: string) => {
        const map = {
          draft: 'è‰ç¨¿',
          pending: 'å®¡æ‰¹ä¸­',
          approved: 'å·²é€šè¿‡',
          rejected: 'å·²é©³å›'
        }
        return map[status] || status
      }
    },
    {
      title: 'æ“ä½œ',
      key: 'action',
      render: (_: any, record: any) => (
        <Space>
          {/* æ‰“å°PDFï¼ˆåªå¯¹approvedçŠ¶æ€å¯ç”¨ï¼‰ */}
          <Button
            disabled={record.status !== 'approved'}
            onClick={() => window.open(`/api/quotation/${record.id}/pdf`)}
          >
            æ‰“å°PDF
          </Button>

          {/* ç”Ÿæˆå§”æ‰˜å•ï¼ˆåªå¯¹approvedçŠ¶æ€å¯ç”¨ï¼‰ */}
          <Button
            type="primary"
            disabled={record.status !== 'approved'}
            onClick={() => handleCreateEntrustment(record.id)}
          >
            ç”Ÿæˆå§”æ‰˜å•
          </Button>

          {/* é©³å›ï¼ˆåªå¯¹pendingçŠ¶æ€å¯ç”¨ï¼‰ */}
          {record.status === 'pending' && (
            <Button
              danger
              onClick={() => {
                setSelectedQuotation(record)
                setRejectModalVisible(true)
              }}
            >
              é©³å›
            </Button>
          )}
        </Space>
      )
    }
  ]

  const handleCreateEntrustment = async (quotationId: string) => {
    try {
      const response = await fetch(
        `/api/quotation/${quotationId}/create-entrustment`,
        {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({})
        }
      )

      const result = await response.json()

      if (result.success) {
        message.success(`å§”æ‰˜å• ${result.data.entrustmentNo} åˆ›å»ºæˆåŠŸ`)
        // åˆ·æ–°åˆ—è¡¨æˆ–è·³è½¬åˆ°å§”æ‰˜å•è¯¦æƒ…
      } else {
        message.error(result.error)
      }
    } catch (error) {
      message.error('åˆ›å»ºå§”æ‰˜å•å¤±è´¥')
    }
  }

  const handleReject = async (rejectReason: string) => {
    try {
      const response = await fetch(
        `/api/quotation/${selectedQuotation.id}/reject`,
        {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ rejectReason })
        }
      )

      const result = await response.json()

      if (result.success) {
        message.success('é©³å›æˆåŠŸ')
        setRejectModalVisible(false)
        // åˆ·æ–°åˆ—è¡¨
      } else {
        message.error(result.error)
      }
    } catch (error) {
      message.error('é©³å›å¤±è´¥')
    }
  }

  return (
    <>
      <Table
        columns={columns}
        dataSource={quotations}
        rowKey="id"
      />

      <Modal
        title="é©³å›æŠ¥ä»·å•"
        open={rejectModalVisible}
        onCancel={() => setRejectModalVisible(false)}
        onOk={() => {
          // è·å–é©³å›åŸå› å¹¶è°ƒç”¨handleReject
        }}
      >
        <Input.TextArea
          rows={4}
          placeholder="è¯·è¾“å…¥é©³å›åŸå› ï¼ˆå¿…å¡«ï¼‰"
        />
      </Modal>
    </>
  )
}
```

---

**å¦‚æœ‰ç–‘é—®ï¼Œè¯·å‚è€ƒï¼š**
- éƒ¨ç½²æŒ‡å—ï¼š`docs/plans/2026-01-28-deployment-guide.md`
- è®¾è®¡æ–‡æ¡£ï¼š`docs/plans/2026-01-28-business-workflow-enhancement-design.md`
